<div class="card">
  <div style="display: flex; gap: 2rem; align-items: start;">
    <div style="text-align: center;">
      <img src="<%= @user.profile_image %>" alt="<%= @user.name %>" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    </div>
    <div style="flex: 1;">
      <h1 style="margin-bottom: 0.5rem;"><%= @user.name %></h1>
      <p><strong>Email:</strong> <%= @user.email %></p>
      <p><strong>Rok założenia:</strong> <%= @user.created_at.strftime('%Y') %></p>
      
      <% if @user.bio.present? %>
        <p><strong>Opis:</strong></p>
        <p style="font-style: italic; color: #555;"><%= @user.bio %></p>
      <% end %>
      
      <% if @user.favorite_genres.present? %>
        <p><strong>Ulubione gatunki:</strong></p>
        <div style="margin-top: 0.5rem;">
          <% @user.favorite_genres.split(',').each do |genre| %>
            <span style="display: inline-block; background: #3498db; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; margin: 0.25rem; font-size: 0.9rem;">
              #<%= genre.strip %>
            </span>
          <% end %>
        </div>
      <% end %>
      
      <% if current_user&.id == @user.id %>
        <div style="margin-top: 1rem;">
          <a href="<%= edit_user_path(@user) %>" class="btn btn-secondary">Edytuj profil</a>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="dashboard-stats">
  <div class="stat-card">
    <div class="stat-label">Łączna liczba książek</div>
    <div class="stat-number"><%= @books_count %></div>
  </div>
  <div class="stat-card read">
    <div class="stat-label">Przeczytane książki</div>
    <div class="stat-number"><%= @read_books_count %></div>
  </div>
  <div class="stat-card unread">
    <div class="stat-label">Nieprzeczytane książki</div>
    <div class="stat-number"><%= @unread_books_count %></div>
  </div>
</div>

<% if current_user.admin? %>
  <div class="card">
    <h2>Akcje Administratora</h2>
    <a href="<%= admin_users_path %>" class="btn btn-primary">Zarządzaj użytkownikami</a>
  </div>
<% end %>

<% top_rated = @user.books.where("rating > 0").order(rating: :desc).limit(5) %>
<div class="card">
  <h2>Najlepiej Oceniane Książki</h2>
  <% if top_rated.any? %>
    <table>
      <thead>
        <tr>
          <th>Tytuł</th>
          <th>Autor</th>
          <th>Ocena</th>
        </tr>
      </thead>
      <tbody>
        <% top_rated.each do |book| %>
          <tr style="cursor: pointer;" onclick="window.location.href = '<%= book_path(book) %>';">
            <td><%= book.title %></td>
            <td><%= book.author %></td>
            <td><span style="font-size: 1.1rem;"><%= book.rating_stars %></span></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <a href="<%= books_user_path(@user) %>" class="btn btn-primary" style="margin-top: 1rem;">Zobacz wszystkie</a>
  <% else %>
    <p style="color: #999;">Brak ocenionych książek</p>
    <a href="<%= books_user_path(@user) %>" class="btn btn-primary" style="margin-top: 1rem;">Zobacz wszystkie</a>
  <% end %>
</div>

<% favorites = @user.books.where(favorite: true) %>
<div class="card">
  <h2>Ulubione Książki (<%= favorites.count %>)</h2>
  <% if favorites.any? %>
    <table>
      <thead>
        <tr>
          <th>Tytuł</th>
          <th>Autor</th>
          <th>Ocena</th>
        </tr>
      </thead>
      <tbody>
        <% favorites.each do |book| %>
          <tr style="cursor: pointer;" onclick="window.location.href = '<%= book_path(book) %>';">
            <td><%= book.title %></td>
            <td><%= book.author %></td>
            <td><span style="font-size: 1.1rem;"><%= book.rating > 0 ? book.rating_stars : 'brak' %></span></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <p style="color: #999;">Brak ulubionych książek</p>
  <% end %>
</div>
